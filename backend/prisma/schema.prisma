generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id          Int        @id @default(autoincrement())
  firstName   String
  lastName    String
  email       String     @unique
  phoneNumber String
  password    String
  role        Role       @default(USER)
  businesses  Business[]
}

model Business {
  id             Int               @id @default(autoincrement())
  ownerId        Int
  name           String
  verified       Boolean           @default(false)
  address        String
  category       String
  subCategory    String
  contactDetails String
  totalRating    Int               @default(0)
  website        String?
  about          String
  owner          User              @relation(fields: [ownerId], references: [id])
  businessHours  BusinessTimings[]
  businessMedia  Media[]           @relation("BusinessMedia")
  reviews        Review[]
}

model Review {
  id            Int      @id @default(autoincrement())
  businessId    Int
  rating        Int
  description   String
  createdAt     DateTime @default(now())
  customerMedia Media[]  @relation("CustomerMedia")
  business      Business @relation(fields: [businessId], references: [id])
}

model Media {
  id              Int       @id @default(autoincrement())
  type            String
  url             String
  customerMediaId Int?
  businessMediaId Int?
  businessMedia   Business? @relation("BusinessMedia", fields: [businessMediaId], references: [id])
  customerMedia   Review?   @relation("CustomerMedia", fields: [customerMediaId], references: [id])
}

model BusinessTimings {
  id          Int       @id @default(autoincrement())
  businessId  Int
  dayOfWeek   DayOfWeek
  openingTime String
  closingTime String
  specialNote String?
  business    Business  @relation(fields: [businessId], references: [id])
}

model OTP {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  otp       String
  expiresAt DateTime
  used      Boolean  @default(false)

  @@unique([email, otp])
}

enum Role {
  BUSINESS
  USER
}

enum DayOfWeek {
  SUNDAY
  MONDAY
  TUESDAY
  WEDNESDAY
  THURSDAY
  FRIDAY
  SATURDAY
}
